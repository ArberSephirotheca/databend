statement ok
DROP DATABASE IF EXISTS db_09_0023

statement ok
CREATE DATABASE db_09_0023

statement ok
USE db_09_0023

# replace into empty table

statement ok
CREATE TABLE test(a int);

statement ok
REPLACE INTO test ON(a) values(1), (2), (3)

query I
SELECT * FROM test
----
1
2
3

statement ok
DROP TABLE test;

# replace into empty table, duplicated keys

statement ok
CREATE TABLE test(a int);

statement error 4000
REPLACE INTO test ON(a) values(1), (2), (2)

statement ok
DROP TABLE test;


# replace into non-empty table

statement ok
CREATE TABLE test(a int);

statement ok
INSERT INTO test values(1), (2), (3)

statement ok
REPLACE INTO test ON(a) values(3), (4)

query I
SELECT * FROM test order by a;
----
1
2
3
4

statement ok
DROP TABLE test;


# on conflict (2nd column)

statement ok
CREATE TABLE test(c1 string, c2 int);

statement ok
INSERT INTO test values('a', 1), ('b', 2), ('c', 3)

statement ok
REPLACE INTO test ON(c2) values('replaced', 3), ('new', 4)

query IT
SELECT c2, c1 FROM test order by c2;
----
1 a
2 b
3 replaced
4 new

statement ok
DROP TABLE test;

# sub query

statement ok
CREATE TABLE test(c1 int, c2 int);

statement ok
REPLACE INTO test ON(c1) select number, number from numbers(101);

query IT
SELECT sum(c1),  sum(c2) FROM test;
----
5050 5050

statement ok
REPLACE INTO test ON(c1) select number, 0 from numbers(101);

query IT
SELECT sum(c1),  sum(c2) FROM test;
----
5050 0

statement ok
DROP TABLE test;

